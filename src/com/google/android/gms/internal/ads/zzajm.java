package com.google.android.gms.internal.ads;

import android.annotation.TargetApi;
import android.content.Context;
import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.content.res.Resources;
import android.os.Bundle;
import android.os.Looper;
import android.support.annotation.GuardedBy;
import com.google.android.gms.ads.internal.zzbv;
import com.google.android.gms.common.util.PlatformVersion;
import com.google.android.gms.common.wrappers.Wrappers;
import com.google.android.gms.dynamite.DynamiteModule;
import java.util.ArrayList;
import java.util.concurrent.atomic.AtomicInteger;
import javax.annotation.Nullable;
import javax.annotation.ParametersAreNonnullByDefault;

@zzadh
@ParametersAreNonnullByDefault
public final class zzajm implements zzakh {
  private Context mContext;
  
  private final Object mLock = new Object();
  
  @Nullable
  private zzgf zzahz = null;
  
  private final zzajt zzcpl = new zzajt();
  
  private final zzakd zzcpm = new zzakd();
  
  @Nullable
  private zznn zzcpn = null;
  
  @Nullable
  private zzgk zzcpo = null;
  
  @Nullable
  private Boolean zzcpp = null;
  
  private String zzcpq;
  
  private final AtomicInteger zzcpr = new AtomicInteger(0);
  
  private final zzajp zzcps = new zzajp(null);
  
  private final Object zzcpt = new Object();
  
  @GuardedBy("mGrantedPermissionLock")
  private zzanz<ArrayList<String>> zzcpu;
  
  private zzes zzvy;
  
  private zzang zzyf;
  
  private boolean zzzv = false;
  
  @Nullable
  private final zzgk zza(@Nullable Context paramContext, boolean paramBoolean1, boolean paramBoolean2) {
    zzna zzna = zznk.zzawk;
    if (!((Boolean)zzkb.zzik().zzd(zzna)).booleanValue())
      return null; 
    if (!PlatformVersion.isAtLeastIceCreamSandwich())
      return null; 
    zzna = zznk.zzaws;
    if (!((Boolean)zzkb.zzik().zzd(zzna)).booleanValue()) {
      zzna = zznk.zzawq;
      if (!((Boolean)zzkb.zzik().zzd(zzna)).booleanValue())
        return null; 
    } 
    if (paramBoolean1 && paramBoolean2)
      return null; 
    synchronized (this.mLock) {
      if (Looper.getMainLooper() == null || paramContext == null)
        return null; 
      if (this.zzahz == null)
        this.zzahz = new zzgf(); 
      if (this.zzcpo == null)
        this.zzcpo = new zzgk(this.zzahz, zzadb.zzc(paramContext, this.zzyf)); 
      this.zzcpo.zzgw();
      zzakb.zzdj("start fetching content...");
      return this.zzcpo;
    } 
  }
  
  @TargetApi(16)
  private static ArrayList<String> zzag(Context paramContext) {
    ArrayList arrayList = new ArrayList();
    try {
      PackageInfo packageInfo = Wrappers.packageManager(paramContext).getPackageInfo((paramContext.getApplicationInfo()).packageName, 4096);
      if (packageInfo.requestedPermissions != null) {
        if (packageInfo.requestedPermissionsFlags == null)
          return arrayList; 
        for (byte b = 0; b < packageInfo.requestedPermissions.length; b++) {
          if ((packageInfo.requestedPermissionsFlags[b] & 0x2) != 0)
            arrayList.add(packageInfo.requestedPermissions[b]); 
        } 
      } 
      return arrayList;
    } catch (android.content.pm.PackageManager.NameNotFoundException paramContext) {
      return arrayList;
    } 
  }
  
  @Nullable
  public final Context getApplicationContext() { return this.mContext; }
  
  @Nullable
  public final Resources getResources() {
    if (this.zzyf.zzcvg)
      return this.mContext.getResources(); 
    resources = null;
    try {
      DynamiteModule dynamiteModule = DynamiteModule.load(this.mContext, DynamiteModule.PREFER_REMOTE, "com.google.android.gms.ads.dynamite");
      if (dynamiteModule != null)
        resources = dynamiteModule.getModuleContext().getResources(); 
      return resources;
    } catch (com.google.android.gms.dynamite.DynamiteModule.LoadingException resources) {
      zzakb.zzc("Cannot load resource from dynamite apk or local jar", resources);
      return null;
    } 
  }
  
  public final void zza(Boolean paramBoolean) {
    synchronized (this.mLock) {
      this.zzcpp = paramBoolean;
      return;
    } 
  }
  
  public final void zza(Throwable paramThrowable, String paramString) { zzadb.zzc(this.mContext, this.zzyf).zza(paramThrowable, paramString); }
  
  public final void zzaa(boolean paramBoolean) { this.zzcps.zzaa(paramBoolean); }
  
  @Nullable
  public final zzgk zzaf(@Nullable Context paramContext) { return zza(paramContext, this.zzcpm.zzqu(), this.zzcpm.zzqw()); }
  
  public final void zzb(Throwable paramThrowable, String paramString) {
    zzadf zzadf = zzadb.zzc(this.mContext, this.zzyf);
    zzna zzna = zznk.zzaul;
    zzadf.zza(paramThrowable, paramString, ((Float)zzkb.zzik().zzd(zzna)).floatValue());
  }
  
  @TargetApi(23)
  public final void zzd(Context paramContext, zzang paramzzang) {
    synchronized (this.mLock) {
      if (!this.zzzv) {
        this.mContext = paramContext.getApplicationContext();
        this.zzyf = paramzzang;
        zzbv.zzen().zza(zzbv.zzep());
        this.zzcpm.initialize(this.mContext);
        this.zzcpm.zza(this);
        zzadb.zzc(this.mContext, this.zzyf);
        this.zzcpq = zzbv.zzek().zzm(paramContext, paramzzang.zzcw);
        this.zzvy = new zzes(paramContext.getApplicationContext(), this.zzyf);
        zzbv.zzet();
        zznn zznn1 = zznk.zzawh;
        if (!((Boolean)zzkb.zzik().zzd(zznn1)).booleanValue()) {
          zzakb.v("CsiReporterFactory: CSI is not enabled. No CSI reporter created.");
          zznn1 = null;
        } else {
          zznn1 = new zznn();
        } 
        this.zzcpn = zznn1;
        zzanm.zza((zzanz)(new zzajo(this)).zznt(), "AppState.registerCsiReporter");
        this.zzzv = true;
        zzqi();
      } 
      return;
    } 
  }
  
  public final void zzd(Bundle paramBundle) {
    if (paramBundle.containsKey("content_url_opted_out") && paramBundle.containsKey("content_vertical_opted_out"))
      zza(this.mContext, paramBundle.getBoolean("content_url_opted_out"), paramBundle.getBoolean("content_vertical_opted_out")); 
  }
  
  public final zzajt zzpx() { return this.zzcpl; }
  
  @Nullable
  public final zznn zzpy() {
    synchronized (this.mLock) {
      return this.zzcpn;
    } 
  }
  
  public final Boolean zzpz() {
    synchronized (this.mLock) {
      return this.zzcpp;
    } 
  }
  
  public final boolean zzqa() { return this.zzcps.zzqa(); }
  
  public final boolean zzqb() { return this.zzcps.zzqb(); }
  
  public final void zzqc() { this.zzcps.zzqc(); }
  
  public final zzes zzqd() { return this.zzvy; }
  
  public final void zzqe() { this.zzcpr.incrementAndGet(); }
  
  public final void zzqf() { this.zzcpr.decrementAndGet(); }
  
  public final int zzqg() { return this.zzcpr.get(); }
  
  public final zzakd zzqh() {
    synchronized (this.mLock) {
      return this.zzcpm;
    } 
  }
  
  public final zzanz<ArrayList<String>> zzqi() {
    if (this.mContext != null && PlatformVersion.isAtLeastJellyBean()) {
      zzna zzna = zznk.zzbau;
      if (!((Boolean)zzkb.zzik().zzd(zzna)).booleanValue())
        synchronized (this.zzcpt) {
          if (this.zzcpu != null)
            return this.zzcpu; 
          zzanz zzanz1 = zzaki.zza(new zzajn(this));
          this.zzcpu = zzanz1;
          return zzanz1;
        }  
    } 
    return zzano.zzi(new ArrayList());
  }
}

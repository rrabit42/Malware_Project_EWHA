package com.gun0912.tedpermission;

import android.content.Context;
import android.content.Intent;
import com.gun0912.tedpermission.busevent.TedBusProvider;
import com.gun0912.tedpermission.busevent.TedPermissionEvent;
import com.gun0912.tedpermission.util.Dlog;
import com.squareup.otto.Subscribe;

public class TedInstance {
  Context context;
  
  public String deniedCloseButtonText;
  
  public String denyMessage;
  
  public boolean hasSettingBtn = true;
  
  public PermissionListener listener;
  
  public String[] permissions;
  
  public String rationaleConfirmText;
  
  public String rationaleMessage;
  
  public String settingButtonText;
  
  public TedInstance(Context paramContext) {
    this.context = paramContext;
    TedBusProvider.getInstance().register(this);
    this.deniedCloseButtonText = paramContext.getString(R.string.tedpermission_close);
    this.rationaleConfirmText = paramContext.getString(R.string.tedpermission_confirm);
  }
  
  public void checkPermissions() {
    Dlog.d("");
    Intent intent = new Intent(this.context, TedPermissionActivity.class);
    intent.putExtra("permissions", this.permissions);
    intent.putExtra("rationale_message", this.rationaleMessage);
    intent.putExtra("deny_message", this.denyMessage);
    intent.putExtra("package_name", this.context.getPackageName());
    intent.putExtra("setting_button", this.hasSettingBtn);
    intent.putExtra("denied_dialog_close_text", this.deniedCloseButtonText);
    intent.putExtra("rationale_confirm_text", this.rationaleConfirmText);
    intent.putExtra("setting_button_text", this.settingButtonText);
    intent.addFlags(268435456);
    this.context.startActivity(intent);
  }
  
  @Subscribe
  public void onPermissionResult(TedPermissionEvent paramTedPermissionEvent) {
    Dlog.d("");
    if (paramTedPermissionEvent.hasPermission()) {
      this.listener.onPermissionGranted();
    } else {
      this.listener.onPermissionDenied(paramTedPermissionEvent.getDeniedPermissions());
    } 
    TedBusProvider.getInstance().unregister(this);
  }
}

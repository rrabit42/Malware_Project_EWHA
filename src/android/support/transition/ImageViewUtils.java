package android.support.transition;

import android.animation.Animator;
import android.graphics.Matrix;
import android.os.Build;
import android.util.Log;
import android.widget.ImageView;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;

class ImageViewUtils {
  private static final String TAG = "ImageViewUtils";
  
  private static Method sAnimateTransformMethod;
  
  private static boolean sAnimateTransformMethodFetched;
  
  static void animateTransform(ImageView paramImageView, Matrix paramMatrix) {
    if (Build.VERSION.SDK_INT < 21) {
      paramImageView.setImageMatrix(paramMatrix);
      return;
    } 
    fetchAnimateTransformMethod();
    Method method = sAnimateTransformMethod;
    if (method != null)
      try {
        method.invoke(paramImageView, new Object[] { paramMatrix });
        return;
      } catch (IllegalAccessException paramImageView) {
        return;
      } catch (InvocationTargetException paramImageView) {
        throw new RuntimeException(paramImageView.getCause());
      }  
  }
  
  private static void fetchAnimateTransformMethod() {
    if (!sAnimateTransformMethodFetched) {
      try {
        sAnimateTransformMethod = ImageView.class.getDeclaredMethod("animateTransform", new Class[] { Matrix.class });
        sAnimateTransformMethod.setAccessible(true);
      } catch (NoSuchMethodException noSuchMethodException) {
        Log.i("ImageViewUtils", "Failed to retrieve animateTransform method", noSuchMethodException);
      } 
      sAnimateTransformMethodFetched = true;
    } 
  }
  
  static void reserveEndAnimateTransform(ImageView paramImageView, Animator paramAnimator) {
    if (Build.VERSION.SDK_INT < 21)
      paramAnimator.addListener(new Object(paramImageView)); 
  }
  
  static void startAnimateTransform(ImageView paramImageView) {
    if (Build.VERSION.SDK_INT < 21) {
      ImageView.ScaleType scaleType = paramImageView.getScaleType();
      paramImageView.setTag(R.id.save_scale_type, scaleType);
      if (scaleType == ImageView.ScaleType.MATRIX) {
        paramImageView.setTag(R.id.save_image_matrix, paramImageView.getImageMatrix());
      } else {
        paramImageView.setScaleType(ImageView.ScaleType.MATRIX);
      } 
      paramImageView.setImageMatrix(MatrixUtils.IDENTITY_MATRIX);
    } 
  }
}

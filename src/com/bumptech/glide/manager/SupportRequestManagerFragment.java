package com.bumptech.glide.manager;

import android.annotation.SuppressLint;
import android.app.Activity;
import android.support.v4.app.Fragment;
import com.bumptech.glide.RequestManager;
import java.util.Collections;
import java.util.HashSet;
import java.util.Set;

public class SupportRequestManagerFragment extends Fragment {
  private final HashSet<SupportRequestManagerFragment> childRequestManagerFragments = new HashSet();
  
  private final ActivityFragmentLifecycle lifecycle;
  
  private RequestManager requestManager;
  
  private final RequestManagerTreeNode requestManagerTreeNode = new SupportFragmentRequestManagerTreeNode(this, null);
  
  private SupportRequestManagerFragment rootRequestManagerFragment;
  
  public SupportRequestManagerFragment() { this(new ActivityFragmentLifecycle()); }
  
  @SuppressLint({"ValidFragment"})
  public SupportRequestManagerFragment(ActivityFragmentLifecycle paramActivityFragmentLifecycle) { this.lifecycle = paramActivityFragmentLifecycle; }
  
  private void addChildRequestManagerFragment(SupportRequestManagerFragment paramSupportRequestManagerFragment) { this.childRequestManagerFragments.add(paramSupportRequestManagerFragment); }
  
  private boolean isDescendant(Fragment paramFragment) {
    Fragment fragment = getParentFragment();
    while (paramFragment.getParentFragment() != null) {
      if (paramFragment.getParentFragment() == fragment)
        return true; 
      paramFragment = paramFragment.getParentFragment();
    } 
    return false;
  }
  
  private void removeChildRequestManagerFragment(SupportRequestManagerFragment paramSupportRequestManagerFragment) { this.childRequestManagerFragments.remove(paramSupportRequestManagerFragment); }
  
  public Set<SupportRequestManagerFragment> getDescendantRequestManagerFragments() {
    SupportRequestManagerFragment supportRequestManagerFragment = this.rootRequestManagerFragment;
    if (supportRequestManagerFragment == null)
      return Collections.emptySet(); 
    if (supportRequestManagerFragment == this)
      return Collections.unmodifiableSet(this.childRequestManagerFragments); 
    HashSet hashSet = new HashSet();
    for (SupportRequestManagerFragment supportRequestManagerFragment1 : this.rootRequestManagerFragment.getDescendantRequestManagerFragments()) {
      if (isDescendant(supportRequestManagerFragment1.getParentFragment()))
        hashSet.add(supportRequestManagerFragment1); 
    } 
    return Collections.unmodifiableSet(hashSet);
  }
  
  ActivityFragmentLifecycle getLifecycle() { return this.lifecycle; }
  
  public RequestManager getRequestManager() { return this.requestManager; }
  
  public RequestManagerTreeNode getRequestManagerTreeNode() { return this.requestManagerTreeNode; }
  
  public void onAttach(Activity paramActivity) {
    super.onAttach(paramActivity);
    this.rootRequestManagerFragment = RequestManagerRetriever.get().getSupportRequestManagerFragment(getActivity().getSupportFragmentManager());
    SupportRequestManagerFragment supportRequestManagerFragment = this.rootRequestManagerFragment;
    if (supportRequestManagerFragment != this)
      supportRequestManagerFragment.addChildRequestManagerFragment(this); 
  }
  
  public void onDestroy() {
    super.onDestroy();
    this.lifecycle.onDestroy();
  }
  
  public void onDetach() {
    super.onDetach();
    SupportRequestManagerFragment supportRequestManagerFragment = this.rootRequestManagerFragment;
    if (supportRequestManagerFragment != null) {
      supportRequestManagerFragment.removeChildRequestManagerFragment(this);
      this.rootRequestManagerFragment = null;
    } 
  }
  
  public void onLowMemory() {
    super.onLowMemory();
    RequestManager requestManager1 = this.requestManager;
    if (requestManager1 != null)
      requestManager1.onLowMemory(); 
  }
  
  public void onStart() {
    super.onStart();
    this.lifecycle.onStart();
  }
  
  public void onStop() {
    super.onStop();
    this.lifecycle.onStop();
  }
  
  public void setRequestManager(RequestManager paramRequestManager) { this.requestManager = paramRequestManager; }
}

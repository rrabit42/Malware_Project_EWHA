package com.android.volley.toolbox;

import android.accounts.Account;
import android.accounts.AccountManager;
import android.accounts.AccountManagerFuture;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import com.android.volley.error.AuthFailureError;

public class AndroidAuthenticator implements Authenticator {
  private final Account mAccount;
  
  private final AccountManager mAccountManager;
  
  private final String mAuthTokenType;
  
  private final boolean mNotifyAuthFailure;
  
  AndroidAuthenticator(AccountManager paramAccountManager, Account paramAccount, String paramString, boolean paramBoolean) {
    this.mAccountManager = paramAccountManager;
    this.mAccount = paramAccount;
    this.mAuthTokenType = paramString;
    this.mNotifyAuthFailure = paramBoolean;
  }
  
  public AndroidAuthenticator(Context paramContext, Account paramAccount, String paramString) { this(paramContext, paramAccount, paramString, false); }
  
  public AndroidAuthenticator(Context paramContext, Account paramAccount, String paramString, boolean paramBoolean) { this(AccountManager.get(paramContext), paramAccount, paramString, paramBoolean); }
  
  public Account getAccount() { return this.mAccount; }
  
  public String getAuthToken() throws AuthFailureError {
    AccountManagerFuture accountManagerFuture = this.mAccountManager.getAuthToken(this.mAccount, this.mAuthTokenType, this.mNotifyAuthFailure, null, null);
    try {
      Bundle bundle = (Bundle)accountManagerFuture.getResult();
      Object object = null;
      String str = object;
      if (accountManagerFuture.isDone()) {
        str = object;
        if (!accountManagerFuture.isCancelled())
          if (!bundle.containsKey("intent")) {
            str = bundle.getString("authtoken");
          } else {
            throw new AuthFailureError((Intent)bundle.getParcelable("intent"));
          }  
      } 
      if (str != null)
        return str; 
      StringBuilder stringBuilder = new StringBuilder();
      stringBuilder.append("Got null auth token for type: ");
      stringBuilder.append(this.mAuthTokenType);
      throw new AuthFailureError(stringBuilder.toString());
    } catch (Exception exception) {
      throw new AuthFailureError("Error while retrieving auth token", exception);
    } 
  }
  
  public String getAuthTokenType() throws AuthFailureError { return this.mAuthTokenType; }
  
  public void invalidateAuthToken(String paramString) { this.mAccountManager.invalidateAuthToken(this.mAccount.type, paramString); }
}

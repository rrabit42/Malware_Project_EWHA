package com.android.volley;

import android.content.Context;
import android.support.v4.content.AsyncTaskLoader;
import com.android.volley.error.VolleyError;
import com.android.volley.request.GsonRequest;
import com.android.volley.toolbox.VolleyTickle;
import com.google.gson.Gson;

public class AsyncRequestLoader<T> extends AsyncTaskLoader<T> {
  private T data;
  
  private VolleyError error;
  
  private GsonRequest<T> request;
  
  public AsyncRequestLoader(Context paramContext, GsonRequest<T> paramGsonRequest) {
    super(paramContext);
    this.request = paramGsonRequest;
  }
  
  private void releaseResources(T paramT) {}
  
  public void deliverResult(T paramT) {
    if (isReset() && paramT != null) {
      releaseResources(paramT);
      return;
    } 
    Object object = this.data;
    this.data = paramT;
    if (isStarted())
      super.deliverResult(paramT); 
    if (object != null && object != paramT)
      releaseResources(object); 
  }
  
  public VolleyError getError() { return this.error; }
  
  public T loadInBackground() {
    RequestTickle requestTickle = VolleyTickle.newRequestTickle(getContext());
    requestTickle.add(this.request);
    NetworkResponse networkResponse = requestTickle.start();
    if (networkResponse.statusCode >= 200 && networkResponse.statusCode < 300)
      this.data = (new Gson()).fromJson(VolleyTickle.parseResponse(networkResponse), this.request.getClazz()); 
    this.error = new VolleyError(networkResponse);
    return (T)this.data;
  }
  
  public void onCanceled(T paramT) {
    super.onCanceled(paramT);
    releaseResources(paramT);
    this.request.cancel();
  }
  
  protected void onReset() {
    onStopLoading();
    Object object = this.data;
    if (object != null) {
      releaseResources(object);
      this.data = null;
    } 
  }
  
  protected void onStartLoading() {
    super.onStartLoading();
    Object object = this.data;
    if (object != null)
      deliverResult(object); 
    if (this.data == null || takeContentChanged())
      forceLoad(); 
  }
  
  protected void onStopLoading() { cancelLoad(); }
}

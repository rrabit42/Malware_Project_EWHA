package android.arch.core.internal;

import android.support.annotation.NonNull;
import android.support.annotation.RestrictTo;
import java.util.Iterator;
import java.util.Map;
import java.util.WeakHashMap;

@RestrictTo({RestrictTo.Scope.LIBRARY_GROUP})
public class SafeIterableMap<K, V> extends Object implements Iterable<Map.Entry<K, V>> {
  private Entry<K, V> mEnd;
  
  private WeakHashMap<SupportRemove<K, V>, Boolean> mIterators = new WeakHashMap();
  
  private int mSize = 0;
  
  private Entry<K, V> mStart;
  
  public Iterator<Map.Entry<K, V>> descendingIterator() {
    DescendingIterator descendingIterator = new DescendingIterator(this.mEnd, this.mStart);
    this.mIterators.put(descendingIterator, Boolean.valueOf(false));
    return descendingIterator;
  }
  
  public Map.Entry<K, V> eldest() { return this.mStart; }
  
  public boolean equals(Object paramObject) {
    if (paramObject == this)
      return true; 
    if (!(paramObject instanceof SafeIterableMap))
      return false; 
    SafeIterableMap safeIterableMap = (SafeIterableMap)paramObject;
    if (size() != safeIterableMap.size())
      return false; 
    paramObject = iterator();
    Iterator iterator = safeIterableMap.iterator();
    while (paramObject.hasNext() && iterator.hasNext()) {
      Map.Entry entry = (Map.Entry)paramObject.next();
      Object object = iterator.next();
      if ((entry == null && object != null) || (entry != null && !entry.equals(object)))
        return false; 
    } 
    return (!paramObject.hasNext() && !iterator.hasNext());
  }
  
  protected Entry<K, V> get(K paramK) {
    Entry entry;
    for (entry = this.mStart; entry != null; entry = entry.mNext) {
      if (entry.mKey.equals(paramK))
        return entry; 
    } 
    return entry;
  }
  
  @NonNull
  public Iterator<Map.Entry<K, V>> iterator() {
    AscendingIterator ascendingIterator = new AscendingIterator(this.mStart, this.mEnd);
    this.mIterators.put(ascendingIterator, Boolean.valueOf(false));
    return ascendingIterator;
  }
  
  public IteratorWithAdditions iteratorWithAdditions() {
    IteratorWithAdditions iteratorWithAdditions = new IteratorWithAdditions(this, null);
    this.mIterators.put(iteratorWithAdditions, Boolean.valueOf(false));
    return iteratorWithAdditions;
  }
  
  public Map.Entry<K, V> newest() { return this.mEnd; }
  
  protected Entry<K, V> put(@NonNull K paramK, @NonNull V paramV) { // Byte code:
    //   0: new android/arch/core/internal/SafeIterableMap$Entry
    //   3: dup
    //   4: aload_1
    //   5: aload_2
    //   6: invokespecial <init> : (Ljava/lang/Object;Ljava/lang/Object;)V
    //   9: astore_1
    //   10: aload_0
    //   11: aload_0
    //   12: getfield mSize : I
    //   15: iconst_1
    //   16: iadd
    //   17: putfield mSize : I
    //   20: aload_0
    //   21: getfield mEnd : Landroid/arch/core/internal/SafeIterableMap$Entry;
    //   24: astore_2
    //   25: aload_2
    //   26: ifnonnull -> 44
    //   29: aload_0
    //   30: aload_1
    //   31: putfield mStart : Landroid/arch/core/internal/SafeIterableMap$Entry;
    //   34: aload_0
    //   35: aload_0
    //   36: getfield mStart : Landroid/arch/core/internal/SafeIterableMap$Entry;
    //   39: putfield mEnd : Landroid/arch/core/internal/SafeIterableMap$Entry;
    //   42: aload_1
    //   43: areturn
    //   44: aload_2
    //   45: aload_1
    //   46: putfield mNext : Landroid/arch/core/internal/SafeIterableMap$Entry;
    //   49: aload_1
    //   50: aload_2
    //   51: putfield mPrevious : Landroid/arch/core/internal/SafeIterableMap$Entry;
    //   54: aload_0
    //   55: aload_1
    //   56: putfield mEnd : Landroid/arch/core/internal/SafeIterableMap$Entry;
    //   59: aload_1
    //   60: areturn }
  
  public V putIfAbsent(@NonNull K paramK, @NonNull V paramV) {
    Entry entry = get(paramK);
    if (entry != null)
      return (V)entry.mValue; 
    put(paramK, paramV);
    return null;
  }
  
  public V remove(@NonNull K paramK) {
    paramK = (K)get(paramK);
    if (paramK == null)
      return null; 
    this.mSize--;
    if (!this.mIterators.isEmpty()) {
      Iterator iterator = this.mIterators.keySet().iterator();
      while (iterator.hasNext())
        ((SupportRemove)iterator.next()).supportRemove(paramK); 
    } 
    if (paramK.mPrevious != null) {
      paramK.mPrevious.mNext = paramK.mNext;
    } else {
      this.mStart = paramK.mNext;
    } 
    if (paramK.mNext != null) {
      paramK.mNext.mPrevious = paramK.mPrevious;
    } else {
      this.mEnd = paramK.mPrevious;
    } 
    paramK.mNext = null;
    paramK.mPrevious = null;
    return (V)paramK.mValue;
  }
  
  public int size() { return this.mSize; }
  
  public String toString() {
    StringBuilder stringBuilder = new StringBuilder();
    stringBuilder.append("[");
    Iterator iterator = iterator();
    while (iterator.hasNext()) {
      stringBuilder.append(((Map.Entry)iterator.next()).toString());
      if (iterator.hasNext())
        stringBuilder.append(", "); 
    } 
    stringBuilder.append("]");
    return stringBuilder.toString();
  }
}

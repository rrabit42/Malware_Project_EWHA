package android.support.v4.app;

import android.content.Context;
import android.content.res.TypedArray;
import android.os.Bundle;
import android.os.Parcelable;
import android.support.annotation.NonNull;
import android.support.annotation.Nullable;
import android.util.AttributeSet;
import android.widget.FrameLayout;
import android.widget.LinearLayout;
import android.widget.TabHost;
import android.widget.TabWidget;
import java.util.ArrayList;

public class FragmentTabHost extends TabHost implements TabHost.OnTabChangeListener {
  private boolean mAttached;
  
  private int mContainerId;
  
  private Context mContext;
  
  private FragmentManager mFragmentManager;
  
  private TabInfo mLastTab;
  
  private TabHost.OnTabChangeListener mOnTabChangeListener;
  
  private FrameLayout mRealTabContent;
  
  private final ArrayList<TabInfo> mTabs = new ArrayList();
  
  public FragmentTabHost(Context paramContext) {
    super(paramContext, null);
    initFragmentTabHost(paramContext, null);
  }
  
  public FragmentTabHost(Context paramContext, AttributeSet paramAttributeSet) {
    super(paramContext, paramAttributeSet);
    initFragmentTabHost(paramContext, paramAttributeSet);
  }
  
  @Nullable
  private FragmentTransaction doTabChanged(@Nullable String paramString, @Nullable FragmentTransaction paramFragmentTransaction) {
    TabInfo tabInfo = getTabInfoForTag(paramString);
    FragmentTransaction fragmentTransaction = paramFragmentTransaction;
    if (this.mLastTab != tabInfo) {
      fragmentTransaction = paramFragmentTransaction;
      if (paramFragmentTransaction == null)
        fragmentTransaction = this.mFragmentManager.beginTransaction(); 
      TabInfo tabInfo1 = this.mLastTab;
      if (tabInfo1 != null && tabInfo1.fragment != null)
        fragmentTransaction.detach(this.mLastTab.fragment); 
      if (tabInfo != null)
        if (tabInfo.fragment == null) {
          tabInfo.fragment = Fragment.instantiate(this.mContext, tabInfo.clss.getName(), tabInfo.args);
          fragmentTransaction.add(this.mContainerId, tabInfo.fragment, tabInfo.tag);
        } else {
          fragmentTransaction.attach(tabInfo.fragment);
        }  
      this.mLastTab = tabInfo;
    } 
    return fragmentTransaction;
  }
  
  private void ensureContent() {
    if (this.mRealTabContent == null) {
      this.mRealTabContent = (FrameLayout)findViewById(this.mContainerId);
      if (this.mRealTabContent != null)
        return; 
      StringBuilder stringBuilder = new StringBuilder();
      stringBuilder.append("No tab content FrameLayout found for id ");
      stringBuilder.append(this.mContainerId);
      throw new IllegalStateException(stringBuilder.toString());
    } 
  }
  
  private void ensureHierarchy(Context paramContext) {
    if (findViewById(16908307) == null) {
      LinearLayout linearLayout = new LinearLayout(paramContext);
      linearLayout.setOrientation(1);
      addView(linearLayout, new FrameLayout.LayoutParams(-1, -1));
      TabWidget tabWidget = new TabWidget(paramContext);
      tabWidget.setId(16908307);
      tabWidget.setOrientation(0);
      linearLayout.addView(tabWidget, new LinearLayout.LayoutParams(-1, -2, 0.0F));
      FrameLayout frameLayout2 = new FrameLayout(paramContext);
      frameLayout2.setId(16908305);
      linearLayout.addView(frameLayout2, new LinearLayout.LayoutParams(0, 0, 0.0F));
      FrameLayout frameLayout1 = new FrameLayout(paramContext);
      this.mRealTabContent = frameLayout1;
      this.mRealTabContent.setId(this.mContainerId);
      linearLayout.addView(frameLayout1, new LinearLayout.LayoutParams(-1, 0, 1.0F));
    } 
  }
  
  @Nullable
  private TabInfo getTabInfoForTag(String paramString) {
    int i = this.mTabs.size();
    for (byte b = 0; b < i; b++) {
      TabInfo tabInfo = (TabInfo)this.mTabs.get(b);
      if (tabInfo.tag.equals(paramString))
        return tabInfo; 
    } 
    return null;
  }
  
  private void initFragmentTabHost(Context paramContext, AttributeSet paramAttributeSet) {
    TypedArray typedArray = paramContext.obtainStyledAttributes(paramAttributeSet, new int[] { 16842995 }, 0, 0);
    this.mContainerId = typedArray.getResourceId(0, 0);
    typedArray.recycle();
    super.setOnTabChangedListener(this);
  }
  
  public void addTab(@NonNull TabHost.TabSpec paramTabSpec, @NonNull Class<?> paramClass, @Nullable Bundle paramBundle) {
    paramTabSpec.setContent(new DummyTabFactory(this.mContext));
    String str = paramTabSpec.getTag();
    TabInfo tabInfo = new TabInfo(str, paramClass, paramBundle);
    if (this.mAttached) {
      tabInfo.fragment = this.mFragmentManager.findFragmentByTag(str);
      if (tabInfo.fragment != null && !tabInfo.fragment.isDetached()) {
        FragmentTransaction fragmentTransaction = this.mFragmentManager.beginTransaction();
        fragmentTransaction.detach(tabInfo.fragment);
        fragmentTransaction.commit();
      } 
    } 
    this.mTabs.add(tabInfo);
    addTab(paramTabSpec);
  }
  
  protected void onAttachedToWindow() {
    super.onAttachedToWindow();
    String str = getCurrentTabTag();
    int i = this.mTabs.size();
    FragmentTransaction fragmentTransaction = null;
    byte b = 0;
    while (b < i) {
      TabInfo tabInfo = (TabInfo)this.mTabs.get(b);
      tabInfo.fragment = this.mFragmentManager.findFragmentByTag(tabInfo.tag);
      FragmentTransaction fragmentTransaction1 = fragmentTransaction;
      if (tabInfo.fragment != null) {
        fragmentTransaction1 = fragmentTransaction;
        if (!tabInfo.fragment.isDetached())
          if (tabInfo.tag.equals(str)) {
            this.mLastTab = tabInfo;
            fragmentTransaction1 = fragmentTransaction;
          } else {
            fragmentTransaction1 = fragmentTransaction;
            if (fragmentTransaction == null)
              fragmentTransaction1 = this.mFragmentManager.beginTransaction(); 
            fragmentTransaction1.detach(tabInfo.fragment);
          }  
      } 
      b++;
      fragmentTransaction = fragmentTransaction1;
    } 
    this.mAttached = true;
    fragmentTransaction = doTabChanged(str, fragmentTransaction);
    if (fragmentTransaction != null) {
      fragmentTransaction.commit();
      this.mFragmentManager.executePendingTransactions();
    } 
  }
  
  protected void onDetachedFromWindow() {
    super.onDetachedFromWindow();
    this.mAttached = false;
  }
  
  protected void onRestoreInstanceState(Parcelable paramParcelable) {
    if (!(paramParcelable instanceof SavedState)) {
      super.onRestoreInstanceState(paramParcelable);
      return;
    } 
    SavedState savedState = (SavedState)paramParcelable;
    super.onRestoreInstanceState(savedState.getSuperState());
    setCurrentTabByTag(savedState.curTab);
  }
  
  protected Parcelable onSaveInstanceState() {
    SavedState savedState = new SavedState(super.onSaveInstanceState());
    savedState.curTab = getCurrentTabTag();
    return savedState;
  }
  
  public void onTabChanged(String paramString) {
    if (this.mAttached) {
      FragmentTransaction fragmentTransaction = doTabChanged(paramString, null);
      if (fragmentTransaction != null)
        fragmentTransaction.commit(); 
    } 
    TabHost.OnTabChangeListener onTabChangeListener = this.mOnTabChangeListener;
    if (onTabChangeListener != null)
      onTabChangeListener.onTabChanged(paramString); 
  }
  
  public void setOnTabChangedListener(TabHost.OnTabChangeListener paramOnTabChangeListener) { this.mOnTabChangeListener = paramOnTabChangeListener; }
  
  @Deprecated
  public void setup() { throw new IllegalStateException("Must call setup() that takes a Context and FragmentManager"); }
  
  public void setup(Context paramContext, FragmentManager paramFragmentManager) {
    ensureHierarchy(paramContext);
    super.setup();
    this.mContext = paramContext;
    this.mFragmentManager = paramFragmentManager;
    ensureContent();
  }
  
  public void setup(Context paramContext, FragmentManager paramFragmentManager, int paramInt) {
    ensureHierarchy(paramContext);
    super.setup();
    this.mContext = paramContext;
    this.mFragmentManager = paramFragmentManager;
    this.mContainerId = paramInt;
    ensureContent();
    this.mRealTabContent.setId(paramInt);
    if (getId() == -1)
      setId(16908306); 
  }
}

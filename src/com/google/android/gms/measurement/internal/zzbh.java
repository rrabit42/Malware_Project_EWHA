package com.google.android.gms.measurement.internal;

import android.content.SharedPreferences;
import android.support.annotation.WorkerThread;
import android.util.Pair;
import com.google.android.gms.common.internal.Preconditions;
import com.google.android.gms.common.util.VisibleForTesting;

public final class zzbh {
  private final long zzabv;
  
  @VisibleForTesting
  private final String zzanv;
  
  private final String zzanw;
  
  private final String zzanx;
  
  private zzbh(zzbd paramzzbd, String paramString, long paramLong) {
    Preconditions.checkNotEmpty(paramString);
    if (paramLong > 0L) {
      bool = true;
    } else {
      bool = false;
    } 
    Preconditions.checkArgument(bool);
    this.zzanx = (this.zzanw = (this.zzanv = String.valueOf(paramString).concat(":start")).valueOf(paramString).concat(":count")).valueOf(paramString).concat(":value");
    this.zzabv = paramLong;
  }
  
  @WorkerThread
  private final void zzfl() {
    this.zzant.zzaf();
    long l = this.zzant.zzbx().currentTimeMillis();
    SharedPreferences.Editor editor = zzbd.zza(this.zzant).edit();
    editor.remove(this.zzanw);
    editor.remove(this.zzanx);
    editor.putLong(this.zzanv, l);
    editor.apply();
  }
  
  @WorkerThread
  private final long zzfn() { return zzbd.zza(this.zzant).getLong(this.zzanv, 0L); }
  
  @WorkerThread
  public final void zzc(String paramString, long paramLong) {
    boolean bool;
    this.zzant.zzaf();
    if (zzfn() == 0L)
      zzfl(); 
    String str = paramString;
    if (paramString == null)
      str = ""; 
    long l = zzbd.zza(this.zzant).getLong(this.zzanw, 0L);
    if (l <= 0L) {
      SharedPreferences.Editor editor1 = zzbd.zza(this.zzant).edit();
      editor1.putString(this.zzanx, str);
      editor1.putLong(this.zzanw, 1L);
      editor1.apply();
      return;
    } 
    paramLong = this.zzant.zzgr().zzmk().nextLong();
    l++;
    if ((paramLong & Float.MAX_VALUE) < Float.MAX_VALUE / l) {
      bool = true;
    } else {
      bool = false;
    } 
    SharedPreferences.Editor editor = zzbd.zza(this.zzant).edit();
    if (bool)
      editor.putString(this.zzanx, str); 
    editor.putLong(this.zzanw, l);
    editor.apply();
  }
  
  @WorkerThread
  public final Pair<String, Long> zzfm() {
    this.zzant.zzaf();
    this.zzant.zzaf();
    long l1 = zzfn();
    if (l1 == 0L) {
      zzfl();
      l1 = 0L;
    } else {
      l1 = Math.abs(l1 - this.zzant.zzbx().currentTimeMillis());
    } 
    long l2 = this.zzabv;
    if (l1 < l2)
      return null; 
    if (l1 > l2 << true) {
      zzfl();
      return null;
    } 
    String str = zzbd.zza(this.zzant).getString(this.zzanx, null);
    l1 = zzbd.zza(this.zzant).getLong(this.zzanw, 0L);
    zzfl();
    return (str == null || l1 <= 0L) ? zzbd.zzamy : new Pair(str, Long.valueOf(l1));
  }
}

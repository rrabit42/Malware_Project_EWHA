package com.google.android.gms.common.api.internal;

import android.content.Context;
import android.os.Looper;
import android.support.annotation.NonNull;
import android.support.annotation.Nullable;
import android.support.v4.util.ArrayMap;
import com.google.android.gms.common.ConnectionResult;
import com.google.android.gms.common.GoogleApiAvailabilityLight;
import com.google.android.gms.common.api.Api;
import com.google.android.gms.common.api.Status;
import com.google.android.gms.common.internal.ClientSettings;
import com.google.android.gms.common.util.concurrent.HandlerExecutor;
import com.google.android.gms.signin.SignInOptions;
import com.google.android.gms.signin.zad;
import java.io.FileDescriptor;
import java.io.PrintWriter;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.Map;
import java.util.Queue;
import java.util.concurrent.TimeUnit;
import java.util.concurrent.locks.Condition;
import java.util.concurrent.locks.Lock;
import javax.annotation.concurrent.GuardedBy;

public final class zax implements zabs {
  private final Looper zabj;
  
  private final GoogleApiManager zabm;
  
  private final Lock zaen;
  
  private final ClientSettings zaes;
  
  private final Map<Api.AnyClientKey<?>, zaw<?>> zaet = new HashMap();
  
  private final Map<Api.AnyClientKey<?>, zaw<?>> zaeu = new HashMap();
  
  private final Map<Api<?>, Boolean> zaev;
  
  private final zaaw zaew;
  
  private final GoogleApiAvailabilityLight zaex;
  
  private final Condition zaey;
  
  private final boolean zaez;
  
  private final boolean zafa;
  
  private final Queue<BaseImplementation.ApiMethodImpl<?, ?>> zafb = new LinkedList();
  
  @GuardedBy("mLock")
  private boolean zafc;
  
  @GuardedBy("mLock")
  private Map<zai<?>, ConnectionResult> zafd;
  
  @GuardedBy("mLock")
  private Map<zai<?>, ConnectionResult> zafe;
  
  @GuardedBy("mLock")
  private zaaa zaff;
  
  @GuardedBy("mLock")
  private ConnectionResult zafg;
  
  public zax(Context paramContext, Lock paramLock, Looper paramLooper, GoogleApiAvailabilityLight paramGoogleApiAvailabilityLight, Map<Api.AnyClientKey<?>, Api.Client> paramMap1, ClientSettings paramClientSettings, Map<Api<?>, Boolean> paramMap2, Api.AbstractClientBuilder<? extends zad, SignInOptions> paramAbstractClientBuilder, ArrayList<zaq> paramArrayList, zaaw paramzaaw, boolean paramBoolean) {
    this.zaen = paramLock;
    this.zabj = paramLooper;
    this.zaey = paramLock.newCondition();
    this.zaex = paramGoogleApiAvailabilityLight;
    this.zaew = paramzaaw;
    this.zaev = paramMap2;
    this.zaes = paramClientSettings;
    this.zaez = paramBoolean;
    HashMap hashMap1 = new HashMap();
    for (Api api : paramMap2.keySet())
      hashMap1.put(api.getClientKey(), api); 
    HashMap hashMap2 = new HashMap();
    ArrayList arrayList = (ArrayList)paramArrayList;
    int j = arrayList.size();
    int i = 0;
    while (i < j) {
      Object object = arrayList.get(i);
      i++;
      object = (zaq)object;
      hashMap2.put(object.mApi, object);
    } 
    Iterator iterator = paramMap1.entrySet().iterator();
    paramBoolean = true;
    int k = 0;
    j = 1;
    for (i = 0; iterator.hasNext(); i = m) {
      Map.Entry entry = (Map.Entry)iterator.next();
      Api api = (Api)hashMap1.get(entry.getKey());
      Api.Client client = (Api.Client)entry.getValue();
      if (client.requiresGooglePlayServices()) {
        if (!((Boolean)this.zaev.get(api)).booleanValue()) {
          k = 1;
        } else {
          k = i;
        } 
        i = 1;
      } else {
        j = k;
        k = i;
        int n = 0;
        i = j;
        j = n;
      } 
      zaw zaw = new zaw(paramContext, api, paramLooper, client, (zaq)hashMap2.get(api), paramClientSettings, paramAbstractClientBuilder);
      this.zaet.put((Api.AnyClientKey)entry.getKey(), zaw);
      if (client.requiresSignIn())
        this.zaeu.put((Api.AnyClientKey)entry.getKey(), zaw); 
      int m = k;
      k = i;
    } 
    if (k == 0 || j != 0 || i != 0)
      paramBoolean = false; 
    this.zafa = paramBoolean;
    this.zabm = GoogleApiManager.zabc();
  }
  
  @Nullable
  private final ConnectionResult zaa(@NonNull Api.AnyClientKey<?> paramAnyClientKey) {
    this.zaen.lock();
    try {
      zaw zaw = (zaw)this.zaet.get(paramAnyClientKey);
      if (this.zafd != null && zaw != null)
        return (ConnectionResult)this.zafd.get(zaw.zak()); 
      return null;
    } finally {
      this.zaen.unlock();
    } 
  }
  
  private final boolean zaa(zaw<?> paramzaw, ConnectionResult paramConnectionResult) { return (!paramConnectionResult.isSuccess() && !paramConnectionResult.hasResolution() && ((Boolean)this.zaev.get(paramzaw.getApi())).booleanValue() && paramzaw.zaab().requiresGooglePlayServices() && this.zaex.isUserResolvableError(paramConnectionResult.getErrorCode())); }
  
  private final boolean zaac() {
    this.zaen.lock();
    try {
      if (!this.zafc || !this.zaez)
        return false; 
      Iterator iterator = this.zaeu.keySet().iterator();
      while (iterator.hasNext()) {
        ConnectionResult connectionResult = zaa((Api.AnyClientKey)iterator.next());
        if (connectionResult != null) {
          boolean bool = connectionResult.isSuccess();
          if (!bool)
            return false; 
          continue;
        } 
        return false;
      } 
      return true;
    } finally {
      this.zaen.unlock();
    } 
  }
  
  @GuardedBy("mLock")
  private final void zaad() {
    ClientSettings clientSettings = this.zaes;
    if (clientSettings == null) {
      this.zaew.zagz = Collections.emptySet();
      return;
    } 
    HashSet hashSet = new HashSet(clientSettings.getRequiredScopes());
    Map map = this.zaes.getOptionalApiSettings();
    for (Api api : map.keySet()) {
      ConnectionResult connectionResult = getConnectionResult(api);
      if (connectionResult != null && connectionResult.isSuccess())
        hashSet.addAll(((ClientSettings.OptionalApiSettings)map.get(api)).mScopes); 
    } 
    this.zaew.zagz = hashSet;
  }
  
  @GuardedBy("mLock")
  private final void zaae() {
    while (!this.zafb.isEmpty())
      execute((BaseImplementation.ApiMethodImpl)this.zafb.remove()); 
    this.zaew.zab(null);
  }
  
  @Nullable
  @GuardedBy("mLock")
  private final ConnectionResult zaaf() {
    Iterator iterator = this.zaet.values().iterator();
    ConnectionResult connectionResult1 = null;
    ConnectionResult connectionResult2 = null;
    int j = 0;
    int i = 0;
    while (iterator.hasNext()) {
      zaw zaw = (zaw)iterator.next();
      Api api = zaw.getApi();
      zai zai = zaw.zak();
      ConnectionResult connectionResult = (ConnectionResult)this.zafd.get(zai);
      if (!connectionResult.isSuccess() && (!((Boolean)this.zaev.get(api)).booleanValue() || connectionResult.hasResolution() || this.zaex.isUserResolvableError(connectionResult.getErrorCode()))) {
        if (connectionResult.getErrorCode() == 4 && this.zaez) {
          int m = api.zah().getPriority();
          if (connectionResult2 == null || i > m) {
            connectionResult2 = connectionResult;
            i = m;
          } 
          continue;
        } 
        int k = api.zah().getPriority();
        if (connectionResult1 == null || j > k) {
          connectionResult1 = connectionResult;
          j = k;
        } 
      } 
    } 
    return (connectionResult1 != null && connectionResult2 != null && j > i) ? connectionResult2 : connectionResult1;
  }
  
  private final <T extends BaseImplementation.ApiMethodImpl<? extends com.google.android.gms.common.api.Result, ? extends Api.AnyClient>> boolean zab(@NonNull T paramT) {
    Api.AnyClientKey anyClientKey = paramT.getClientKey();
    ConnectionResult connectionResult = zaa(anyClientKey);
    if (connectionResult != null && connectionResult.getErrorCode() == 4) {
      paramT.setFailedResult(new Status(4, null, this.zabm.zaa(((zaw)this.zaet.get(anyClientKey)).zak(), System.identityHashCode(this.zaew))));
      return true;
    } 
    return false;
  }
  
  @GuardedBy("mLock")
  public final ConnectionResult blockingConnect() {
    connect();
    while (true) {
      if (isConnecting())
        try {
          this.zaey.await();
          continue;
        } catch (InterruptedException interruptedException) {
          Thread.currentThread().interrupt();
          return new ConnectionResult(15, null);
        }  
      if (isConnected())
        return ConnectionResult.RESULT_SUCCESS; 
      ConnectionResult connectionResult = this.zafg;
      return (connectionResult != null) ? connectionResult : new ConnectionResult(13, null);
    } 
  }
  
  @GuardedBy("mLock")
  public final ConnectionResult blockingConnect(long paramLong, TimeUnit paramTimeUnit) {
    connect();
    for (paramLong = paramTimeUnit.toNanos(paramLong); isConnecting(); paramLong = this.zaey.awaitNanos(paramLong)) {
      if (paramLong <= 0L)
        try {
          disconnect();
          return new ConnectionResult(14, null);
        } catch (InterruptedException paramTimeUnit) {
          Thread.currentThread().interrupt();
          return new ConnectionResult(15, null);
        }  
    } 
    if (isConnected())
      return ConnectionResult.RESULT_SUCCESS; 
    ConnectionResult connectionResult = this.zafg;
    return (connectionResult != null) ? connectionResult : new ConnectionResult(13, null);
  }
  
  public final void connect() {
    this.zaen.lock();
    try {
      boolean bool = this.zafc;
      if (bool)
        return; 
      this.zafc = true;
      this.zafd = null;
      this.zafe = null;
      this.zaff = null;
      this.zafg = null;
      this.zabm.zao();
      this.zabm.zaa(this.zaet.values()).addOnCompleteListener(new HandlerExecutor(this.zabj), new zaz(this, null));
      return;
    } finally {
      this.zaen.unlock();
    } 
  }
  
  public final void disconnect() {
    this.zaen.lock();
    try {
      this.zafc = false;
      this.zafd = null;
      this.zafe = null;
      if (this.zaff != null) {
        this.zaff.cancel();
        this.zaff = null;
      } 
      this.zafg = null;
      while (!this.zafb.isEmpty()) {
        BaseImplementation.ApiMethodImpl apiMethodImpl = (BaseImplementation.ApiMethodImpl)this.zafb.remove();
        apiMethodImpl.zaa(null);
        apiMethodImpl.cancel();
      } 
      this.zaey.signalAll();
      return;
    } finally {
      this.zaen.unlock();
    } 
  }
  
  public final void dump(String paramString, FileDescriptor paramFileDescriptor, PrintWriter paramPrintWriter, String[] paramArrayOfString) {}
  
  public final <A extends Api.AnyClient, R extends com.google.android.gms.common.api.Result, T extends BaseImplementation.ApiMethodImpl<R, A>> T enqueue(@NonNull T paramT) {
    if (this.zaez && zab(paramT))
      return paramT; 
    if (!isConnected()) {
      this.zafb.add(paramT);
      return paramT;
    } 
    this.zaew.zahe.zab(paramT);
    return (T)((zaw)this.zaet.get(paramT.getClientKey())).doRead(paramT);
  }
  
  public final <A extends Api.AnyClient, T extends BaseImplementation.ApiMethodImpl<? extends com.google.android.gms.common.api.Result, A>> T execute(@NonNull T paramT) {
    Api.AnyClientKey anyClientKey = paramT.getClientKey();
    if (this.zaez && zab(paramT))
      return paramT; 
    this.zaew.zahe.zab(paramT);
    return (T)((zaw)this.zaet.get(anyClientKey)).doWrite(paramT);
  }
  
  @Nullable
  public final ConnectionResult getConnectionResult(@NonNull Api<?> paramApi) { return zaa(paramApi.getClientKey()); }
  
  public final boolean isConnected() {
    this.zaen.lock();
    try {
      if (this.zafd != null) {
        ConnectionResult connectionResult = this.zafg;
        if (connectionResult == null)
          return true; 
      } 
      return false;
    } finally {
      this.zaen.unlock();
    } 
  }
  
  public final boolean isConnecting() {
    this.zaen.lock();
    try {
      if (this.zafd == null) {
        null = this.zafc;
        if (null)
          return true; 
      } 
      return false;
    } finally {
      this.zaen.unlock();
    } 
  }
  
  public final boolean maybeSignIn(SignInConnectionListener paramSignInConnectionListener) {
    this.zaen.lock();
    try {
      if (this.zafc && !zaac()) {
        this.zabm.zao();
        this.zaff = new zaaa(this, paramSignInConnectionListener);
        this.zabm.zaa(this.zaeu.values()).addOnCompleteListener(new HandlerExecutor(this.zabj), this.zaff);
        return true;
      } 
      return false;
    } finally {
      this.zaen.unlock();
    } 
  }
  
  public final void maybeSignOut() {
    this.zaen.lock();
    try {
      this.zabm.maybeSignOut();
      if (this.zaff != null) {
        this.zaff.cancel();
        this.zaff = null;
      } 
      if (this.zafe == null)
        this.zafe = new ArrayMap(this.zaeu.size()); 
      ConnectionResult connectionResult = new ConnectionResult(4);
      for (zaw zaw : this.zaeu.values())
        this.zafe.put(zaw.zak(), connectionResult); 
      if (this.zafd != null)
        this.zafd.putAll(this.zafe); 
      return;
    } finally {
      this.zaen.unlock();
    } 
  }
  
  public final void zaw() {}
}

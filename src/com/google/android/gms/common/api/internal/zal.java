package com.google.android.gms.common.api.internal;

import android.app.PendingIntent;
import android.content.DialogInterface;
import android.content.Intent;
import android.os.Bundle;
import android.os.Handler;
import android.os.Looper;
import android.support.annotation.Nullable;
import com.google.android.gms.common.ConnectionResult;
import com.google.android.gms.common.GoogleApiAvailability;
import com.google.android.gms.common.util.VisibleForTesting;
import com.google.android.gms.internal.base.zal;
import java.util.concurrent.atomic.AtomicReference;

public abstract class zal extends LifecycleCallback implements DialogInterface.OnCancelListener {
  protected final GoogleApiAvailability zacc;
  
  protected final AtomicReference<zam> zade = new AtomicReference(null);
  
  private final Handler zadf = new zal(Looper.getMainLooper());
  
  protected zal(LifecycleFragment paramLifecycleFragment) { this(paramLifecycleFragment, GoogleApiAvailability.getInstance()); }
  
  @VisibleForTesting
  private zal(LifecycleFragment paramLifecycleFragment, GoogleApiAvailability paramGoogleApiAvailability) {
    super(paramLifecycleFragment);
    this.zacc = paramGoogleApiAvailability;
  }
  
  private static int zaa(@Nullable zam paramzam) { return (paramzam == null) ? -1 : paramzam.zar(); }
  
  public void onActivityResult(int paramInt1, int paramInt2, Intent paramIntent) {
    zam zam = (zam)this.zade.get();
    int j = 1;
    int i = 1;
    if (paramInt1 != 1) {
      if (paramInt1 != 2) {
        zam zam1 = zam;
      } else {
        j = this.zacc.isGooglePlayServicesAvailable(getActivity());
        if (j == 0) {
          paramInt1 = i;
        } else {
          paramInt1 = 0;
        } 
        if (zam == null)
          return; 
        zam zam1 = zam;
        paramInt2 = paramInt1;
        if (zam.getConnectionResult().getErrorCode() == 18) {
          zam1 = zam;
          paramInt2 = paramInt1;
          if (j == 18)
            return; 
        } 
        if (paramInt2 != 0) {
          zaq();
          return;
        } 
      } 
    } else {
      if (paramInt2 == -1) {
        zam zam1 = zam;
        paramInt2 = j;
      } else {
        zam zam1 = zam;
        if (paramInt2 == 0) {
          paramInt1 = 13;
          if (paramIntent != null)
            paramInt1 = paramIntent.getIntExtra("<<ResolutionFailureErrorDetail>>", 13); 
          zam1 = new zam(new ConnectionResult(paramInt1, null), zaa(zam));
          this.zade.set(zam1);
        } 
        paramInt2 = 0;
      } 
      if (paramInt2 != 0) {
        zaq();
        return;
      } 
    } 
    paramInt2 = 0;
  }
  
  public void onCancel(DialogInterface paramDialogInterface) {
    zaa(new ConnectionResult(13, null), zaa((zam)this.zade.get()));
    zaq();
  }
  
  public void onCreate(Bundle paramBundle) {
    super.onCreate(paramBundle);
    if (paramBundle != null) {
      AtomicReference atomicReference = this.zade;
      if (paramBundle.getBoolean("resolving_error", false)) {
        zam zam = new zam(new ConnectionResult(paramBundle.getInt("failed_status"), (PendingIntent)paramBundle.getParcelable("failed_resolution")), paramBundle.getInt("failed_client_id", -1));
      } else {
        paramBundle = null;
      } 
      atomicReference.set(paramBundle);
    } 
  }
  
  public void onSaveInstanceState(Bundle paramBundle) {
    super.onSaveInstanceState(paramBundle);
    zam zam = (zam)this.zade.get();
    if (zam != null) {
      paramBundle.putBoolean("resolving_error", true);
      paramBundle.putInt("failed_client_id", zam.zar());
      paramBundle.putInt("failed_status", zam.getConnectionResult().getErrorCode());
      paramBundle.putParcelable("failed_resolution", zam.getConnectionResult().getResolution());
    } 
  }
  
  public void onStart() {
    super.onStart();
    this.mStarted = true;
  }
  
  public void onStop() {
    super.onStop();
    this.mStarted = false;
  }
  
  protected abstract void zaa(ConnectionResult paramConnectionResult, int paramInt);
  
  public final void zab(ConnectionResult paramConnectionResult, int paramInt) {
    zam zam = new zam(paramConnectionResult, paramInt);
    if (this.zade.compareAndSet(null, zam))
      this.zadf.post(new zan(this, zam)); 
  }
  
  protected abstract void zao();
  
  protected final void zaq() {
    this.zade.set(null);
    zao();
  }
}
